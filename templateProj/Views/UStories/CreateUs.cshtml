@model  templateProj.Models.Manager_UserStories
@{
    Layout = null;

    string ProPicPath = Model.Umodel.ProfilePic;
    string Uname = Model.Umodel.Username;
    //string us = @Model.Ustories; //@Model.Ustories;
}




   <script>
       
       
      // if ('/Uname' != null) {
           var x = 0;
           var color; // Store the Color Code
           var USarray = []; //store the user stories
           var Story;
           var Priority;
           var Duration;
           var Desc;
           
     //  }
       var tempId;
       var lastUpdatedUsID;
       var CusID;

       function CreateStory()
       {          
           Story = $('#story').val();
           Priority = SelectItem();
           Duration = $('#dura').val();
           Desc = $('#desc').val();
           CusID = ((UsDetails.length + USarray.length) * -1) - 1;
         
           var Ustory = CusID + ";" + Story + ";" + color + ";" + Priority + ";" + Desc + ";" + Duration;
           USarray.push(Ustory);
       }

</script>




<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Project base | Create User Stories</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="../../Styles/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- fullCalendar 2.2.5-->
    <link rel="stylesheet" href="../plugins/fullcalendar/fullcalendar.min.css">
    <link rel="stylesheet" href="../plugins/fullcalendar/fullcalendar.print.css" media="print">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../Styles/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect.
    -->
    <link rel="stylesheet" href="../../Styles/dist/css/skins/skin-blue.min.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|







-->
<body class="hold-transition skin-blue sidebar-mini" onload="Ustories();" >

    <style>
        .modal-body .form-horizontal .col-sm-2,
.modal-body .form-horizontal .col-sm-10 {
    width: 100%
}

.modal-body .form-horizontal .control-label {
    text-align: left;
}
.modal-body .form-horizontal .col-sm-offset-2 {
    margin-left: 15px;
}
    </style>



    <div class="wrapper">
       
       @Html.Partial("_ManagerNavigation", Model.Umodel);




        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    User Stories
                    <small></small>
                </h1>

            </section>
            <ol class="breadcrumb" style="left:100px ; top:50px ; background-color:transparent" >
                <li><a href="@Url.Action("Home", "Home" )"><i class="fa fa-dashboard"></i> Home</a></li>

                <li class="active">Create</li>
                <li class="active">User Stories</li>
            </ol>


            <!-- Story Creator -->
            <section class="content">
                <div class="row">
                    <div class="col-md-3">

                        <div class="box box-solid">
                            <div class="box-header with-border">
                                <h3 class="box-title">Create User Stories</h3>
                            </div>
                            <div class="box-body">
                                <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
                                    <!--<button type="button" id="color-chooser-btn" class="btn btn-info btn-block dropdown-toggle" data-toggle="dropdown">Color <span class="caret"></span></button>-->
                                    <ul class="fc-color-picker" id="color-chooser">
                                        <li><a class="text-aqua" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-blue" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-light-blue" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-teal" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-yellow" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-orange" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-green" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-lime" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-red" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-purple" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-fuchsia" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-muted" href="#"><i class="fa fa-square"></i></a></li>
                                        <li><a class="text-navy" href="#"><i class="fa fa-square"></i></a></li>
                                    </ul>
                                </div><!-- /btn-group -->
                                <div class="input-group">
                                    @*<input id="new-event" type="text" class="form-control" placeholder="User Story">*@
                                    <div class="input-group-btn">
                                        @*<button id="add-new-event" type="button" class="btn btn-primary btn-flat">Add</button>*@

                                        <!-- Button trigger modal -->
                                        <button class="btn btn-primary btn-group-sm" data-toggle="modal" data-target="#myModalHorizontal" style="position:inherit; left:150px" id="addStory" onclick="clearModal();">
                                            Add Story
                                        </button>


                                    </div><!-- /btn-group -->
                                </div><!-- /input-group -->
                            </div>
                        </div>
                    </div><!-- /.col -->
                    <div class="col-md-5">
                        <div class="box box-solid">
                            <div class="box-header with-border">
                                <h4 class="box-title">User Stories</h4>
                            </div>


                            <div class="box-body">
                                <!-- user story container -->

                                <div id="external-events" style="overflow-y:auto ; height:250px">


                                </div>
                                <div class="checkbox">
                                    
                                </div>
                            </div><!-- /.box-body -->

                        </div><!-- /. box -->
                    </div><!-- /.col -->

                    <div class="col-md-2">
                        <div class="box box-solid" style="background-color:transparent">
                            <button id="saveB" class="btn btn-block btn-default btn-lg" onclick="save();">Save</button>
                            <button class="btn btn-block btn-default btn-lg">Send</button>
                        </div>
                    </div>
                </div><!-- /.row -->
            </section><!-- /. Story Creator -->
            <section>
                <!-- Main content -->
                <!-- Your Page Content Here -->
            </section><!-- /.content -->
        </div><!-- /.content-wrapper -->


       



    <!--Create Ustory Modal -->

        <div class="modal fade" id="myModalHorizontal" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header" id="Cheader">
                        <button type="button" class="close"
                                data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            Create new user story
                        </h4>
                    </div>

                    <div class="modal-header" id="Eheader" hidden="hidden">
                        <button type="button" class="close"
                                data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            Edit User Story
                        </h4>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">

                        <form class="form-horizontal" role="form" id="f1">
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="story">User Story</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control"
                                           id="story" placeholder="User Story"  required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="colorCode">Color Code</label>
                                <div class="col-sm-10">
                                    <ul class="fc-color-picker" >
                                        <li><a class="text-aqua" href="#" id="color-box"><i class="fa fa-square" ></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="story">Priority</label>
                                <div class="col-sm-10">                               
                                    <select class="form-control" id="prio" onchange="SelectItem();" required>
                                        <option>High</option>
                                        <option>Medium</option>
                                        <option>Low</option>
                                        
                                    </select>                                                               
                                </div>
                                </div>   
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="dura">Duration</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control"
                                           id="dura" placeholder="Hours" required/>
                                </div>
                            </div>     
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="desc">Description</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" rows="5" id="desc" required></textarea>
                                </div>
                            </div>                                               
                        </form>

                    </div>






                    <script>
                        function SelectItem()
                        {
                            var selectedText = $('#prio').find("option:selected").text();
                            return selectedText;
                            //window.alert(selectedText);
                        }   
                    </script>

                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                                data-dismiss="modal" onclick="close();">
                            Close
                        </button>
                        <button type="button" class="btn btn-default"
                                id="editB" onclick="EditUstory()" hidden="hidden">
                            Edit
                        </button>
                        <button type="button" class="btn btn-primary" id="add-new-event" onclick="CreateStory();" data-dismiss="modal">
                            Create
                        </button>
                        <button type="button" class="btn btn-primary" id="SaveUs" onclick="UpdateUstory();" data-dismiss="modal" hidden="hidden">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>



        @Html.Partial("_ManagerFooter");
    </div><!-- ./wrapper -->
    <!-- REQUIRED JS SCRIPTS -->
    <!-- jQuery 2.1.4 -->
    <script src="../../Styles/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="~/Styles/bootstrap/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="../../Styles/dist/js/app.min.js"></script>
    <!-- Optionally, you can add Slimscroll and FastClick plugins.
         Both of these plugins are recommended to enhance the
         user experience. Slimscroll is required when using the
         fixed layout. -->
    <!-- jQuery UI 1.11.4 -->
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <!-- Slimscroll -->
    <script src="../../Styles/plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="../../Styles/plugins/fastclick/fastclick.min.js"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="../../Styles/dist/js/demo.js"></script>
    <!-- fullCalendar 2.2.5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
    <script src="../../Styles/plugins/fullcalendar/fullcalendar.min.js"></script>
    <!-- Page specific script -->

   


   



    <script>

    var id = '@Uname';
    var UsDetails = [];

    function Ustories() {


        var x = -1;

        @foreach (var item in Model.Ustory)
         {
                 <text>
        var s = x + ";" + '@item.UserStory' + ";" + '@item.ColorCode' + ";" + '@item.Priority' + ";" + '@item.Description' + ";" + '@item.Duration' + ";" + '@item.USid';
        LoadUS('@item.UserStory', '@item.ColorCode', x); // Creating the user story divs
        x--;
        UsDetails.push(s);

        </text>


      }


        @*var arr = .split(";");
        var x;
        var y = 0;
        var Arr = [];

        for (x in arr) {
            if (arr[x] != "") {
                Arr[y] = arr[x];
                y++;
            }
        }

        for (i = 0; i < Arr.length ; i++) {
            LoadUS(Arr[i], Arr[i + 1]);
            i++;
        }*@

    }



    function save() { //Send User Stories

        var StoryArr = [];
        // window.alert(UsDetails.length );

        if (USarray.length <= 0 && UsDetails.length > 0) {
           
            var ele = 0;
            for (e in UsDetails) {
                if (UsDetails[e].split(";")[0] > 0) {
                    StoryArr[ele] = UsDetails[e];
                    ele++;
                }
            }
        }
        else if (UsDetails.length <= 0 && USarray.length > 0) {
            StoryArr = USarray;
        }
        else {
            var ele = 0;
            for (e in UsDetails) {
                if (UsDetails[e].split(";")[0] > 0) {
                    StoryArr[ele] = UsDetails[e];
                    ele++;
                }
            }

            for (e in USarray) {
                StoryArr[ele] = USarray[e];
                ele++;
            }

        }

         //for (e in StoryArr)
         //{
         //    window.alert(StoryArr[e]);
         //}


        $.ajax({
            type: 'POST',
            url: '/UStories/SaveUs',
            data: { USarr: StoryArr },

            traditional: true,
            success: function (response) {

                //change the save button appearance
                document.getElementById("saveB").className = "btn btn-block btn-success btn-lg";
                document.getElementById("saveB").innerHTML = "Saved";


            }

        });
    }





    $(function () {

        /* initialize the external events
         -----------------------------------------------------------------*/
        function ini_events(ele) {
            ele.each(function () {

                // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
                // it doesn't need to have a start or end


                // make the event draggable using jQuery UI
                $(this).draggable({
                    zIndex: 1070,
                    revert: true, // will cause the event to go back to its
                    revertDuration: 0  //  original position after the drag
                });




            });
        }
        ini_events($('#external-events div.external-event'));




        /* ADDING EVENTS */
        var currColor = "#3c8dbc"; //Red by default
        //Color chooser button
        var colorChooser = $("#color-chooser-btn");
        $("#color-chooser > li > a").click(function (e) {
            e.preventDefault();
            //Save color
            currColor = $(this).css("color");
            curClass = $(this).attr('class');
            //window.alert(curClass)
            //Add color effect to button
            $('#addStory').css({ "background-color": currColor, "border-color": currColor });
            $('#color-box').removeClass();
            $('#color-box').addClass(curClass);
            color = currColor;


        });






        $("#add-new-event").click(function (e) {
            e.preventDefault();

            //change the save button appearance
            document.getElementById("saveB").className = "btn btn-block btn-default btn-lg";
            document.getElementById("saveB").innerHTML = "Save";

            // window.alert("dd");

            //Get value and make sure it is not null
            var val = $("#story").val();
            if (val.length == 0) {
                return;
            }

            // gathering user stories
            //USarray.push(val);
            // USarray.push(color);






            //Create events
            var event = $('<div>');
            event.css({ "background-color": currColor, "border-color": currColor, "color": "#fff" }).addClass("external-event");
            event.html(val);
            event.attr("id", CusID);
            // window.alert(CusID);
            // event.wrap('<a href="#" data-toggle="tooltip" data-placement="bottom" title="Hooray!"></a>');
            event.css('cursor', 'default');
            var e = $("<a href='#' class='close' data-dismiss='alert' aria-label='close' >&times;</a>");
            event.append(e);
            $('#external-events').prepend(event);


            //Add draggable funtionality
            // ini_events(event );


            //Remove event from text input

            $("#new-event").val("");
            clearModal();
        });
    });



    function LoadUS(val, currColor, id) {

        //Get value and make sure it is not null
        // var val = $("#new-event").val();
        if (val.length == 0) {
            return;


        }

        //USarray.push(val); // gathering user stories
        //USarray.push(currColor);

        //Create events
        var event = $('<div>');
        event.css({ "background-color": currColor, "border-color": currColor, "color": "#fff" }).addClass("external-event");
        event.html(val);
        event.attr("id", id);
        // event.wrap('<a href="#" data-toggle="tooltip" data-placement="bottom" title="Hooray!"></a>');
        event.css('cursor', 'default');
        var e = $("<a href='#' class='close' data-dismiss='alert' aria-label='close' >&times;</a>");
        event.append(e);
        $('#external-events').prepend(event);

    }


    //Add draggable funtionality
    // ini_events(event);



    var check = true;
    var activeUS;

    $('#external-events').on('click', '.close', function () {

        $(this).parent().hide();
        check = false;
    });

    $('#external-events').on('click', '.external-event', function () {
        if (check) {

            clearModal();
            var empty = true;
            //window.alert($(this).attr("id"));
            //window.alert(USarray[0]);
            for (s1 in UsDetails) {
                var temp = false;
                if (UsDetails[s1].split(";")[0] < 0) {
                    if (UsDetails[s1].split(";")[0] == $(this).attr("id")) {
                        temp = true;
                    }
                }
                else {
                    if (UsDetails[s1].split(";")[0] == $(this).attr("id") * -1) {
                        temp = true;
                    }
                }
                //window.alert("a");
                if (temp) {
                    // window.alert("fuck");
                    var arr = UsDetails[s1].split(";");

                    $('#story').val(arr[1]);
                    // $('#color-box').val(arr[0]);
                    $('#prio').val(arr[3]);
                    $('#desc').val(arr[4]);
                    $('#dura').val(arr[5]);

                    tempId = arr[0]; // get the id of the last updated story
                    empty = false;
                    break;
                }


            }


            if (empty) {
                for (s2 in USarray) {
                    // window.alert(USarray[s1].split(";")[0]);
                    var temp = false;
                    if (USarray[s2].split(";")[0] < 0) {
                        if (USarray[s2].split(";")[0] == $(this).attr("id")) {
                            temp = true;
                        }
                    }
                    else {
                        if (USarray[s2].split(";")[0] == $(this).attr("id") * -1) {
                            temp = true;
                        }
                    }


                    //window.alert("b");
                    // window.alert("shit" + USarray[s1]);
                    if (temp) {

                        var arr = USarray[s2].split(";");
                        // window.alert(arr[0]);
                        $('#story').val(arr[1]);
                        // $('#color-box').val(arr[0]);
                        $('#prio').val(arr[3]);
                        $('#desc').val(arr[4]);
                        $('#dura').val(arr[5]);

                        tempId = arr[0]; // get the id of the last updated story
                        break;
                    }
                }
            }

            $('#story').attr('disabled', true);
            $('#prio').attr('disabled', true);
            $('#dura').attr('disabled', true);
            $('#desc').attr('disabled', true);
            $('#SaveUs').attr('disabled', true);
            $('#editB').show();
            $('#SaveUs').show();
            $('#add-new-event').hide();
            $('#Eheader').show();
            $('#Cheader').hide();
            $('#myModalHorizontal').modal({
                show: 'show'
            });


        }
    });

    function EditUstory() {
        $('#story').attr('disabled', false);
        $('#prio').attr('disabled', false);
        $('#dura').attr('disabled', false);
        $('#desc').attr('disabled', false);
        $('#SaveUs').attr('disabled', false);
    }


    function UpdateUstory() {

        lastUpdatedUsID = tempId;
        //window.alert(lastUpdatedUsID);
        var empty = true;

        for (s1 in UsDetails) {
            var arr = UsDetails[s1].split(";");

            if (arr[0] == lastUpdatedUsID) {
                if (lastUpdatedUsID < 0 && arr.length == 7)
                    arr[0] = arr[0] * -1;
                else
                    arr[0] = arr[0];

                arr[1] = $('#story').val();
                arr[3] = SelectItem();
                arr[4] = $('#desc').val();
                arr[5] = $('#dura').val();

               // window.alert(arr[5] + "dd" + arr[6]);
                UsDetails[s1] = arr[0] + ";" + arr[1] + ";" + arr[2] + ";" + arr[3] + ";" + arr[4] + ";" + arr[5] +";"+ arr[6];
                empty = false;

                if (lastUpdatedUsID < 0) {
                    // $(lastUpdatedUsID).text(arr[1]);
                    document.getElementById(lastUpdatedUsID).innerHTML = arr[1];
                }
                else {
                    // $(lastUpdatedUsID * -1).text(arr[1]);
                    document.getElementById(lastUpdatedUsID * -1).innerHTML = arr[1];
                }

                break;
            }

        }

        if (empty) {
            for (s1 in USarray) {

                var arr = USarray[s1].split(";");

                if (arr[0] == lastUpdatedUsID) {
                    if (lastUpdatedUsID < 0)
                        arr[0] = arr[0] * -1;
                    else
                        arr[0] = arr[0];
                    arr[1] = $('#story').val();
                    arr[3] = SelectItem();
                    arr[4] = $('#desc').val();
                    arr[5] = $('#dura').val();

                    USarray[s1] = arr[0] + ";" + arr[1] + ";" + arr[2] + ";" + arr[3] + ";" + arr[4] + ";" + arr[5];
                    empty = false;

                    if (lastUpdatedUsID < 0) {
                        // $(lastUpdatedUsID).text(arr[1]);
                        document.getElementById(lastUpdatedUsID).innerHTML = arr[1];
                    }
                    else {
                        // $(lastUpdatedUsID * -1).text(arr[1]);
                        document.getElementById(lastUpdatedUsID * -1).innerHTML = arr[1];
                    }

                    break;
                }

            }

            //change the save button appearance
            document.getElementById("saveB").className = "btn btn-block btn-default btn-lg";
            document.getElementById("saveB").innerHTML = "Save";
        }



        //Story = $('#story').val();
        //Priority = SelectItem();
        //Duration = $('#dura').val();
        //Desc = $('#desc').val();



    }

    function close() {
        $('#story').attr('disabled', false);
        $('#prio').attr('disabled', false);
        $('#dura').attr('disabled', false);
        $('#desc').attr('disabled', false);
        $('#editB').hide();
        $('#SaveUs').hide();
        $('#add-new-event').show();
        $('#Eheader').hide();
        $('#Cheader').show();
    }

    function clearModal() {
        $('#story').attr('disabled', false);
        $('#prio').attr('disabled', false);
        $('#dura').attr('disabled', false);
        $('#desc').attr('disabled', false);
        $('#editB').hide();
        $('#SaveUs').hide();
        $('#add-new-event').show();
        $('#Eheader').hide();
        $('#Cheader').show();

        $('#story').val("");
        // $('#color-box').val(arr[0]);
        $('#prio').val("");
        $('#desc').val("");
        $('#dura').val("");

    }
    </script>

    

</body>


</html>
